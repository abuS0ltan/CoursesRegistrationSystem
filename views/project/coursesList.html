<style>
    @import url('https://fonts.googleapis.com/css2?family=Delicious+Handrawn&display=swap');
    @import url('https://fonts.googleapis.com/css2?family=Fasthand&display=swap');
    @import url('https://fonts.googleapis.com/css2?family=Allison&family=Bebas+Neue&family=Love+Ya+Like+A+Sister&family=Pacifico&family=Rubik+Dirt&display=swap');
    :root{
    /* --mainColor:#4CAF50; */
}
/*  
    font-family: 'Delicious Handrawn', cursive; 
    font-family: 'Fasthand', cursive;
    font-family: 'Love Ya Like A Sister', cursive;

*/
    .container-fluid.main-container{
        height: 100vh;
        background-image: url('https://www.ppu.edu/p/sites/default/files/styles/slider/public/ppu-1646830058-%D8%AC%D8%A7%D9%85%D8%B9%D8%A9%20%D8%A8%D9%88%D9%84%D9%8A%D8%AA%D9%83%D9%86%D9%83%20%D9%81%D9%84%D8%B3%D8%B7%D9%8A%D9%86.jpg?itok=I3Z3cfoD');
        background-size: cover;
        margin-top: 0;
        position: relative;
        overflow: auto;
   }
   .container-fluid.main-container .overlay{
        background-color: rgba(0, 0, 0,.5);
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        overflow: auto;
    }
    .mainTitle{
        color: white;
        font-family: 'Delicious Handrawn', cursive; 
        font-size: 3rem;
        padding-top: 1rem;
        margin: auto;
        width: fit-content;

    }
    .info{
        color: whitesmoke;
        font-family: 'Fasthand', cursive;
        font-size: 2rem;
    }
    .overlay .container{
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
    }
    .overlay .container .row.row1{
        justify-content: center;
        height: 100%;
        width: 100%;
    }
    .table.data{
        border-radius: 1rem;
        background-color: rgba(255, 255, 255,.8);
        border-width: 0px;
        width: 100%;
    }
    .table.data thead tr th{
        border-top-width: 0px;
    }
    .table .row{
        padding:0 1rem ;
    }
    .row .table.data th{
        border-top-width: 0px;

            border-bottom-width: 0px;
    }
    .row .table.data td{
        border-top-width: 0px;
        border-bottom-width: 0px;
    }
    .modal{
        overflow: auto;
        top: 20%;
    }
    .navbar .navbar-brand{
        font-family: 'Love Ya Like A Sister', cursive;
        font-weight: 600;
    }
    .navbar .nav-link{
        font-family: 'Love Ya Like A Sister', cursive;
    }
    .needtowrap{
        overflow: auto;
    }
    .overlay .container .errorAlert{
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        display: none;
    }
    @media (max-width: 992px) { 
        :root{
            font-size: 10px;
        }
        .row .table.data th,.row .table.data td{
            font-size: 1rem;
            border-bottom-width: 0px;
        }
     }
     @media (max-height: 400px){
        .modal{
            top: 10%;
        }
     }
</style>
{{extend 'layout.html'}}
<div class="overlay">
    <div class="container">
        <div class="row row1">
            <div class="col-12 my-5">
                <h1 class="mainTitle">
                    Courses List
                </h1>
                <!-- <p class="info">With us, you can control and perform all your registration processes.</p> -->
            </div>
            <div class="col-md-4">
                <div class="search-div">
                    <input type="search" placeholder="Search code..." class="form-control my-2" id="searchCode" >
                </div>
            </div>
            <div class="col-md-4">
                <div class="search-div">
                    <input type="search" placeholder="Search by course name..." class="form-control my-2" id="searchName" >
                </div>
            </div>
            <div class="col-md-4">
                <div class="search-div">
                    <input type="search" placeholder="Search by instructor name..." class="form-control my-2" id="searchInstructor" >
                </div>
            </div>
            <div class="col-12">
                
                    <table class="table text-dark data text-center my-5">
                        <thead>
                        <tr class="row">
                            <th class="col needtowrap">#</th>
                            <th class="col needtowrap">Code</th>
                            <th class="col-3 needtowrap">Name</th>
                            <th class="col-3 needtowrap">Instructor</th>
                            <th class="col-3 needtowrap">Achion</th>
                        </tr>
                        </thead>
                        <tbody class="coursesDataTable">
                          
                        </tbody>
                      </table>
                
            </div>
        </div>
        <div class="row">
            
        </div>
    </div>
    <div class="modal" tabindex="-1">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title"></h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <p class="modalCode"></p>
              <p class="modalDescription"></p>
              <p class="modalInstructor"></p>
              <p class="modalDays"></p>
              <p class="modalTime"></p>
              <p class="modalRoom"></p>
              <p class="modalPrerequisites"> </p>
              <p class="modalCapacity"></p>

            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary close2" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
</div>
<script>
    let coursesDataTable =document.querySelector('.coursesDataTable');
    let coursesData =[];
    let schedulesData =[];
    let regCountData =[];
    let regCount =[];
    let FullCourses=[];
    let regCoursesData=[];
    //------------------------------make my layout-----------------------------
    $('.navbar-nav.w-100.justify-content-center').css('display','none');
    $('.form-control.mr-sm-2').css('display','none');
    let logo=document.querySelector('a.navbar-brand.d-flex.w-50.mr-auto');
    logo.innerHTML='Registration System';
    logo.setAttribute('href','homePage');
    // navbar-nav
    let navbar_collapse=document.querySelector('.navbar-collapse.collapse.w-100');
    navbar_collapse.innerHTML=`
    <ul class="navbar-nav mr-auto">
      <li class="nav-item active">
        <a class="nav-link" href="homePage">Home <span class="sr-only">(current)</span></a>
      </li>
      <li class="nav-item active">
        <a class="nav-link" href="{{=request.function}}">Courses List <span class="sr-only">(current)</span></a>
      </li>
      <li class="nav-item active">
        <a class="nav-link" href="yourCourses">Your Courses<span class="sr-only">(current)</span></a>
      </li>
      <li class="nav-item active">
        <a class="nav-link" href="coursesList">News<span class="sr-only">(current)</span></a>
      </li>
    </ul>
    `+navbar_collapse.innerHTML;
    $('.close').click(function(){
        $('.modal').css('display','none');
    })
    $('.close2').click(function(){
        $('.modal').css('display','none');
    })
//------------------------------end my layout-----------------------------
//------------------------------fetch data-----------------------------

async function getData(){
    data=await fetch("coursesData.json");
    return data.json();
}
async function getSchedulesData(){
    data=await fetch("schedulesData.json");
    return data.json();
}
async function getRegCountData(){
    data=await fetch("regCount.json");
    return data.json();
}
async function getRegCoursesData(){
    data=await fetch("regsData.json");
    return data.json();
}
(async()=>{
   const arr= await getData();
   coursesData=arr.rows;
   const arr2=await getSchedulesData();
   schedulesData = arr2.rows;
   const arr3=await getRegCountData();
   regCountData = arr3.regs;
   const arr4=await getRegCoursesData();
   regCoursesData= arr4.rows;
   console.log(regCoursesData);
   await calcNumReg();
   await displayData(coursesData);
})();

//------------------------------end fetch data-----------------------------

//------------------------------calc number reg for every course-----------------------------
async function calcNumReg(){
    count = 0;
    
    for (let index = 0; index < coursesData.length; index++) {
        for (let x = 0; x < regCountData.length; x++) {
            if (regCountData[x].coursed==coursesData[index].id) {
                count++;
            }
        }
        let y={
            coursesId:coursesData[index].id,
            num:count
        }
        regCount.push(y);
        count=0;
    }
}
//------------------------------end calc-----------------------------

//------------------------------disabled add full course -----------------------------
function disabledFull(){
    for (let index = 0; index < regCount.length; index++) {
        
            if (coursesData[index].capacity==regCount[index].num) {
                FullCourses.push(coursesData[index].id);
            }
            
        
    }
}
//------------------------------end disabled add full course-----------------------------

//------------------------------disabled add not disabled courses -----------------------------
function disableddisabled(){

}
//------------------------------end disabled add not Prerequisites courses-----------------------------

//------------------------------display data-----------------------------

async function displayData(apperData){
    disabledFull();
    let full=false;
    let dontTakePrerequisites=false;
    let dataToTable = '';
    let idPrerequisites='';
    for (let index = 0; index < apperData.length; index++) {
        for (let x = 0; x < FullCourses.length; x++) {
            if(FullCourses[x]==apperData[index].id)
            {
                full=true;
                break;
            }
        }
        if(apperData[index].prerequisites!=null){
            dontTakePrerequisites=true;
            let a = 0;
            for (; a < apperData.length; a++) {
                if(apperData[index].prerequisites==apperData[a].code)
                {
                    idPrerequisites=apperData[a].id;
                    break;
                }
            }
            for (let z = 0; z < regCoursesData.length; z++) {
                if(regCoursesData[z].coursed==idPrerequisites)
                {
                    dontTakePrerequisites=false;
                    break;
                }
            }
        }
        if(full||dontTakePrerequisites){
            dataToTable=dataToTable+`
            <tr class='row'>
                <th class='col needtowrap'>${apperData[index].id}</th>
                <td class='col needtowrap'>${apperData[index].code}</td>
                <td class='col-3 needtowrap'>${apperData[index].name}</td>
                <td class='col-3 needtowrap'>${apperData[index].instructor}</td>
                <td class='col-3 needtowrap'>
                    <button class="btn btn-primary"  onclick='displayDetails(${index})'>Details</button>
                    <br>
                    <button class="btn btn-danger mt-1" disabled>Add</button>
                </td>
            </tr>
        `;
    }
    else
    {
        dataToTable=dataToTable+`
            <tr class='row'>
                <th class='col needtowrap'>${apperData[index].id}</th>
                <td class='col needtowrap'>${apperData[index].code}</td>
                <td class='col-3 needtowrap'>${apperData[index].name}</td>
                <td class='col-3 needtowrap'>${apperData[index].instructor}</td>
                <td class='col-3 needtowrap position-relative'>
                    <button class="btn btn-primary"  onclick='displayDetails(${index})'>Details</button>
                    <br>
                    <button class="btn btn-danger mt-1 ">Add</button>
                </td>
            </tr>
        `;
    }
    dontTakePrerequisites=false;
    idPrerequisites='';
    full=false;
    }
        
    coursesDataTable.innerHTML=dataToTable;

    }
//------------------------------srarch------------------------------
let searchInstructor = document.getElementById('searchInstructor');
let searchName = document.getElementById('searchName');
let searchCode = document.getElementById('searchCode');
searchCode.addEventListener('keyup',function(){
    let dataApper=[];
    for (let index = 0; index < coursesData.length; index++) {
        if(coursesData[index].code.toString().includes(searchCode.value))
            dataApper.push(coursesData[index]);
    }
    displayData(dataApper);
})
searchName.addEventListener('keyup',function(){
    let dataApper=[];
    for (let index = 0; index < coursesData.length; index++) {
        if(coursesData[index].name.includes(searchName.value.toLowerCase()))
            dataApper.push(coursesData[index]);
    }
    displayData(dataApper);
})
searchInstructor.addEventListener('keyup',function(){
    let dataApper=[];
    for (let index = 0; index < coursesData.length; index++) {
        if(coursesData[index].instructor.toLowerCase().includes(searchInstructor.value.toLowerCase()))
            dataApper.push(coursesData[index]);
    }
    displayData(dataApper);
})
//------------------------------end search-----------------------------
//------------------------------details-----------------------------
function displayDetails(index){
    let x=0;
    $('.modal').css('display','block');
    document.querySelector('.modal-title').innerHTML=coursesData[index].name;
    document.querySelector('.modalCode').innerHTML=`code: ${coursesData[index].code}.`;
    if(coursesData[index].description==null)
        document.querySelector('.modalDescription').innerHTML=`Description: No Description :( .`;
    else
        document.querySelector('.modalDescription').innerHTML=`Description: ${coursesData[index].description}.`;
    document.querySelector('.modalInstructor').innerHTML=`Instructor: ${coursesData[index].instructor}.`;
    if(coursesData[index].prerequisites==null)
        document.querySelector('.modalPrerequisites').innerHTML=`Prerequisites: No Prerequisites :) .`;
    else
        document.querySelector('.modalPrerequisites').innerHTML=`Prerequisites: ${coursesData[index].prerequisites}.`;
    for (; x < schedulesData.length; x++) {
        if(coursesData[index].schedul==schedulesData[x].id)
            break;
    }
    document.querySelector('.modalDays').innerHTML=`Days: ${schedulesData[x].days}.`;
    document.querySelector('.modalTime').innerHTML=`Time: ${schedulesData[x].startTime} - ${schedulesData[x].endTime}.`;
    document.querySelector('.modalRoom').innerHTML=`Room: ${schedulesData[x].room}.`;
    document.querySelector('.modalCapacity').innerHTML=`Capacity: ${regCount[index].num}/${coursesData[index].capacity}.`;

}
//------------------------------end details-----------------------------
</script>